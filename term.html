<html>
<head>
<link rel="stylesheet" href="term.css" type="text/css">
<!--<script type="text/javascript" src="jquery-1.6.2.js">-->
<!--<script type="text/javascript" src="term.js">-->
<style type="text/css">
#termdiv {
  position: absolute;
  top:0px;
  bottom:0px;
  left:0px;
  right:0px;
}

pre {
  margin:0px;
}
</style>

<script type="text/javascript">
function scroll_to_bottom() {
  var termdiv = document.getElementById('termdiv');
  termdiv.scrollTop = termdiv.scrollHeight;
}

function set_line(linenumber, content) {
  var term = document.getElementById('term');
  
  if (!term.childNodes || !term.childNodes[linenumber]) {
    for (var i=term.childNodes.length; i <= linenumber; i++) {
      term.appendChild(document.createElement("span"));
    }
  }

  term.childNodes[linenumber].innerHTML = content + "\n";
}

function insert_line(linenumber, content) {
  var term = document.getElementById('term');
  var span = document.createElement('span');
  span.innerHTML = content;
  term.insertBefore(span, term.childNodes[linenumber]);
}

function pop_to_history() {
  var term = document.getElementById('term');
  var hist = document.getElementById('history');
  var topmost = term.childNodes[0];
  term.removeChild(topmost);
  hist.appendChild(topmost);
}

function pop_line(i) {
  var term = document.getElementById('term');
  var line = term.childNodes[i];
  term.removeChild(line);
}

function append_line(content) {
  var term = document.getElementById('term');
  var span = document.createElement("span");
  span.innerHTML = content + "\n";
  term.appendChild(span);
}

// function history_append(content) {
//   var hist = document.getElementById('history');
//   var span = document.createElement("span");
//   span.innerHTML = content + "\n";
//   hist.appendChild(span);
// }

function resize_handler(event) {
  var term = document.getElementById("termdiv");
  var pre = document.getElementById("termpre");
  var specimen = document.createElement("span");
  specimen.innerHTML = "a";
  //specimen.style = "display:noneg";
  pre.appendChild(specimen);
  
  var cols  = Math.floor(term.clientWidth/specimen.offsetWidth);
  var lines = Math.floor(term.clientHeight/specimen.offsetHeight);
  //console.log("resized to [lines, cols]: [" + lines + " ," + cols + "]");
  pre.removeChild(specimen);
  
  // IPC
  console.log('schirm{"width":'+cols+',"height":'+lines+'}');
}

//function writeTerminalScreen(string) {
//  var t = document.getElementById("term");
//  t.textContent = string;
//}
//
// $(document).ready(function() {
//   // $("#button").click(function(){ console.log("clicked") });
//   console.log("BLA");
// });
</script>

</head>
<body onresize="resize_handler()">
<div id="termdiv" style="overflow-y:scroll"><pre id="historypre"><div id="history" style="overflow-x:hide;font-family:monospace"></div></pre><pre id="termpre"><div id="term" style="overflow-x:hide;font-family:monospace"></div></pre></div>
</body>
</html>
